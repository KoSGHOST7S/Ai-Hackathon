(function () {
  const match = window.location.pathname.match(/^\/courses\/(\d+)\/assignments\/(\d+)/);
  if (!match) return;

  const courseId = match[1];
  const assignmentId = match[2];

  // Inline SVG so it always renders (no cross-origin img issues)
  const MINT_SVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="-5.0 -10.0 110.0 115.0" width="18" height="18" style="display:block;flex-shrink:0;"><path fill="#ffffff" d="m7.6758 49.789c-1.5547 0.75391-4.8477 2.2969-3.9023 4.3398 1.9961 3.6094 5.8672 6.3281 9.1836 7.8711-1.0117 0.96094-2.8711 2.3828-1.6758 3.8398 3.2656 3.7031 6.7578 5.6133 9.4961 6.5938-1.0938 1.2109-3.1055 3.6289-1.6523 5.1094 4.8594 4.2344 11.398 6.6055 16.301 6.1094-0.15234 1.5898-0.066406 4.6328 2.3164 3.75 4.6484-1.3398 14.891 0.17188 16.324-5.8008 2.7891-1.2461 5.2734-3.0625 7.3633-5.3359 2.8906 4.6875 5.2969 9.6914 7.1797 14.984 0.28906 0.82031 1.2031 1.2383 1.9961 0.94922 0.8125-0.28906 1.2383-1.1836 0.94922-1.9961-2.0859-5.8594-4.8008-11.367-8.0703-16.508 2.75-3.8945 4.1797-8.5078 4.168-13.121 5.2969-3.5742-0.40234-12.586-1.0703-17.453-0.16016-2.5391-2.9727-1.3828-4.3672-0.60156-1.5352-4.6836-6.3438-9.7031-12.18-12.438-1.9453-0.73438-3.3438 2.0898-4 3.582-2.0664-2.1758-5.2188-4.5508-9.875-6.0234-1.8125-0.5-2.3633 1.7656-2.8398 3.0742-2.9141-2.5508-6.9766-4.8516-10.91-5.1992-2.2656-0.019531-2.332 3.6016-2.3906 5.3477-4.2461-0.39844-10.504 1.0312-15.668 2.2148-1.1875 0.28125-1.4102 1.4297-1.0664 2.4648 1.125 5.4492 2.4375 10.84 4.3945 14.25zm13.66-15.508c1.1133 0.42578 2.3398-0.68359 2.0312-1.8359-0.29297-1.2617-0.30469-2.5195-0.039063-3.6406 3.6211 0.76562 7.3594 3.4219 9.4883 5.7812 0.34766 0.41406 0.88672 0.53125 1.4023 0.54297 2.2461 0.12891 1.5625-2.7305 2.2773-4.0664 4.4688 1.7031 7.1211 4.3359 8.5938 6.3281 0.62891 0.69141 1.8906 1.1953 2.75 0.64453 0.42578-0.27344 0.69531-0.73828 0.71875-1.2461 0.058594-1.3242 0.45703-2.4922 1.1406-3.3828 5.375 2.8477 9.6406 7.8711 9.8945 11.789 0.039062 1.2383 1.6328 1.9219 2.5586 1.1016 0.50391-0.41406 1.0508-0.77734 1.6328-1.0742 1.0664 3.793 4.918 11.957 1.6445 13.023-0.58594 0.26172-0.95313 0.85547-0.92188 1.5 0.18359 3.875-0.82812 7.6992-2.8984 11.109-10.645-16.438-31.5-28.516-44.207-31.625-1.9688-0.53906-2.8477 2.3828-0.875 3 12.711 3.1289 32.914 15.059 43.148 31.316-2.0781 2.4453-4.6602 4.332-7.5938 5.5039-0.55859 0.22266-0.94141 0.75-0.98047 1.3516 0.15625 3.2344-8.7227 3.0469-12.562 3.5938 0.035157-0.65234 0.14453-1.3008 0.32422-1.9258 0.37891-1.1797-0.89844-2.3594-2.043-1.8945-3.6914 1.3516-10.008-0.51953-14.789-4.2852 0.48828-0.90625 1.2812-1.6758 2.3281-2.2617 0.42969-0.24219 0.72266-0.66797 0.78906-1.1602 0.16797-1.0156-1.1406-2.2031-1.9922-2.5664-2.2422-0.60156-5.4648-1.9805-8.5977-5.1367 0.54297-0.52734 1.1797-1 1.9023-1.4102 1.4609-0.80078 0.60937-2.9961-0.63281-3.5508-2.9688-1.0703-6.6211-3.332-8.6641-6.1719 0.91797-0.69531 2.0703-1.1953 3.3398-1.4336 1.1758-0.18359 1.6914-1.7461 0.85938-2.5938-2.3555-2.5508-4.0117-9.9023-4.832-13.82 3.7891-0.86719 11.551-2.6328 14.812-1.5078z"/><path fill="#ffffff" d="m94.117 14.805c-4.8047-1.0898-10.094-2.168-13.879-1.8359-0.058593-1.7227-0.12891-5.3008-2.375-5.2617-3.8594 0.34766-7.8477 2.5977-10.723 5.0977-0.46484-1.2773-1.0312-3.5117-2.8125-3-4.5742 1.4492-7.6719 3.7695-9.7031 5.9023-0.67578-1.5039-1.9961-4.207-3.9531-3.5-6.0859 2.8516-11.125 8.2695-12.25 13.176-0.42578 2.0078 2.5508 2.6953 3.0469 0.69922 0.85156-3.7148 4.7852-8.0195 9.5391-10.547 0.65234 0.86328 1.0352 2.0039 1.0938 3.3008 0.023438 0.51172 0.29688 0.98047 0.73438 1.2539 0.71484 0.54688 2.2422-0.007813 2.7266-0.64453 1.4375-1.9492 4.0391-4.5273 8.4297-6.207 0.61719 1.1133 0.14453 2.7188 1.1172 3.6289 0.70703 0.55859 1.9141 0.48437 2.5273-0.17578 2.0898-2.3164 5.7578-4.9219 9.3086-5.6797 0.25 1.0938 0.23828 2.3125-0.054687 3.543-0.30859 1.1523 0.90625 2.2578 2.0273 1.8359 3.1875-1.0977 10.836 0.63672 14.508 1.4688-0.39844 3.1445-3.1484 12.594-4.7109 13.57-0.83203 0.84766-0.31641 2.4062 0.85547 2.5938 1.25 0.23828 2.3711 0.72266 3.2617 1.3867-2.0039 2.7734-5.582 4.9922-8.4961 6.0469-0.44141 0.15234-0.76172 0.51172-0.94922 0.92969-0.29297 0.50781-0.60938 1.0547-0.41797 1.6602 0.36719 1.1562 1.9062 1.4414 2.5938 2.3164-3.0742 3.0938-6.2344 4.4492-8.4258 5.043-0.89062 0.41406-2.1133 1.4531-1.9844 2.5312 0.0625 0.49609 0.35547 0.92969 0.78906 1.1719 0.75781 0.42188 1.6914 1.1211 2.2773 2.1953-2.3438 1.8555-5.1875 3.3086-7.9531 4.0547-0.83203 0.22656-1.3281 1.082-1.1016 1.9141 0.82422 3.5703 10.465-2.8047 11.965-4.3281 1.4258-1.5078-0.50781-3.7891-1.5938-5.0234 2.6875-0.97656 6.1094-2.8594 9.3125-6.4922 1.1836-1.4375-0.62109-2.8398-1.625-3.7852 3.2617-1.5234 7.0586-4.1992 9.0117-7.7461 0.91016-2.0703-2.2617-3.5234-3.8281-4.293 2.0703-3.4492 3.7031-10.836 4.4414-14.609 0.29297-1.6797-1.3906-1.9336-2.7148-2.1836z"/><path fill="#ffffff" d="m61.113 34.938c6.8594-4.7383 14.445-8.3516 22.551-10.738 1.9531-0.60938 1.1055-3.543-0.88281-3-8.4258 2.4844-16.316 6.2383-23.445 11.168-1.6641 1.1484 0.09375 3.7422 1.7773 2.5703z"/></svg>`;

  function injectButton() {
    if (document.getElementById('assignmint-btn')) return;

    const target = document.querySelector('.right-of-crumbs');
    if (!target) return;

    const btn = document.createElement('button');
    btn.id = 'assignmint-btn';
    btn.type = 'button';
    btn.innerHTML = MINT_SVG + '<span>Open in Assignmint</span>';

    btn.style.cssText = [
      'display:inline-flex',
      'align-items:center',
      'gap:7px',
      'padding:7px 14px 7px 11px',
      'border:none',
      'border-radius:7px',
      'background:#4BA87A',
      'color:#ffffff',
      'font-size:13px',
      'font-weight:600',
      'font-family:inherit',
      'cursor:pointer',
      'white-space:nowrap',
      'line-height:1',
      'letter-spacing:0.01em',
      'box-shadow:0 1px 3px rgba(0,0,0,0.15)',
      'margin-right:6px',
      'transition:background 0.12s,box-shadow 0.12s',
    ].join(';');

    btn.addEventListener('mouseenter', () => {
      btn.style.background = '#3d9468';
      btn.style.boxShadow = '0 2px 6px rgba(0,0,0,0.2)';
    });
    btn.addEventListener('mouseleave', () => {
      btn.style.background = '#4BA87A';
      btn.style.boxShadow = '0 1px 3px rgba(0,0,0,0.15)';
    });
    btn.addEventListener('mousedown', () => {
      btn.style.background = '#357d5a';
      btn.style.boxShadow = '0 1px 2px rgba(0,0,0,0.15)';
    });

    btn.addEventListener('click', () => {
      chrome.storage.local.set({ pendingAnalyze: { courseId, assignmentId } });
      chrome.runtime.sendMessage({ action: 'openPopup' });
    });

    target.insertBefore(btn, target.firstChild);
  }

  injectButton();

  if (!document.getElementById('assignmint-btn')) {
    document.addEventListener('DOMContentLoaded', injectButton);
  }
})();
